{% extends "base.html" %}
{% block title %}プラン作成{% endblock %}

<style>
/* 入力欄とプルダウンの高さ・フォントを揃える */
.shop-formset-item {
  margin-bottom: 18px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
}
.shop-formset-row {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 12px !important;
  width: 100%;
}
.shop-formset-item input[type="text"] {
  height: 40px !important;
  font-size: 16px !important;
  box-sizing: border-box !important;
  border-radius: 7px !important;
  border: 1.5px solid #ffb3b3 !important;
  display: block !important;
  background: linear-gradient(90deg, #fffafa 0%, #ffffff 100%) !important;
  color: #a33 !important;
  margin: 0 !important;
  padding: 0 14px !important;
  line-height: 40px !important;
  width: 100%;
}
.shop-formset-item .form-label {
  font-size: 0.95em;
  color: #444;
  margin-bottom: 0;
  white-space: nowrap;
  display: inline-block;
  margin-top: 0;
}
.shop-formset-item select,
.shop-formset-item input[type="number"] {
  height: 40px !important;
  font-size: 16px !important;
  box-sizing: border-box !important;
  border-radius: 7px !important;
  border: 1.5px solid #ffb3b3 !important;
  display: inline-block !important;
  background: linear-gradient(90deg, #ffe5e5 0%, #fff5f5 100%) !important;
  color: #a33 !important;
  margin: 0 !important;
  padding: 0 14px !important;
  line-height: 40px !important;
  width: auto !important;
  min-width: 90px;
}
.shop-formset-item input[type="number"] {
  width: 80px !important;
}
.shop-formset-item .white-min {
  font-size:0.95em;
  color:#fff !important;
  margin-left:2px;
  display: inline-block;
}
</style>
{% block content %}

<div class="plan-form-vertical">
  <h1>Create New Plan</h1>
  <form method="post" class="plan-form-vertical-form login-form-vertical">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {% for f in form %}
      <label class="login-label" style="width: 100%; margin-bottom: 12px;">
        <span style="font-weight:600; margin-bottom: 2px;">{{ f.label }}</span>
        {{ f }}
        {% for e in f.errors %}
          <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
        {% endfor %}
      </label>
    {% endfor %}


    <div style="margin-top: 24px;">
      <h3>Shops Visited (1 to 10 shops)</h3>
      {{ formset.management_form }}
      <div id="shop-formset-list">
        {% for spot_form in formset %}
          <div class="shop-formset-item">
            {{ spot_form.name }}
            <div class="shop-formset-row">
              <span class="form-label">滞在時間</span>
              {{ spot_form.stay_minutes }}
              {% if not forloop.last %}
                <span class="form-label" style="margin:0 0 0 16px;">↕ 移動時間</span>
                <input type="number" name="move_minutes_{{ forloop.counter0 }}" min="0" max="180" step="1" value="0" />
                <span class="white-min">分</span>
              {% endif %}
            </div>
            {% for e in spot_form.name.errors %}
              <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
            {% endfor %}
            {% for e in spot_form.stay_minutes.errors %}
              <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
            {% endfor %}
          </div>
        {% endfor %}
      </div>
      <div style="margin-top:8px; color:#888; font-size:0.95em;">You must enter at least 1 shop (up to 5).</div>
    </div>

  <!-- JS不要: Add/Delete機能なし・5個固定 -->

    <button type="submit">Save</button>
  </form>
  <p style="margin-top:16px;"><a href="/">← Back to Home</a></p>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const prefSel = document.getElementById("id_pref");
    const subSel  = document.getElementById("id_sub_area");
    if (!prefSel || !subSel) return;

    // Python側の辞書と同じ内容をJSに持たせる（このページだけで完結）
    const MAP = {
      "北海道": ["札幌駅","函館駅","旭川駅","小樽駅","釧路駅"],
      "青森県": ["青森駅","弘前駅","八戸駅"],
      "岩手県": ["盛岡駅","一ノ関駅","釜石駅"],
      "宮城県": ["仙台駅","石巻駅","松島海岸駅"],
      "秋田県": ["秋田駅","大館駅","横手駅"],
      "山形県": ["山形駅","米沢駅","鶴岡駅"],
      "福島県": ["福島駅","郡山駅","会津若松駅"],
      "茨城県": ["水戸駅","つくば駅","土浦駅"],
      "栃木県": ["宇都宮駅","日光駅","小山駅"],
      "群馬県": ["高崎駅","前橋駅","草津温泉駅"],
      "埼玉県": ["大宮駅","川越駅","秩父駅"],
      "千葉県": ["千葉駅","舞浜駅","成田空港駅"],
      "東京都": ["東京駅","新宿駅","渋谷駅","池袋駅","上野駅","品川駅","下北沢駅","高円寺駅","町田駅","吉祥寺駅"],
      "神奈川県":["横浜駅","川崎駅","鎌倉駅","小田原駅","江ノ島駅","中山駅","桜木町","橋本駅","センター北駅"],
      "新潟県": ["新潟駅","長岡駅","佐渡両津港"],
      "富山県": ["富山駅","高岡駅"],
      "石川県": ["金沢駅","和倉温泉駅"],
      "福井県": ["福井駅","芦原温泉駅"],
      "山梨県": ["甲府駅","河口湖駅"],
      "長野県": ["長野駅","松本駅","軽井沢駅"],
      "岐阜県": ["岐阜駅","高山駅","下呂駅"],
      "静岡県": ["静岡駅","浜松駅","熱海駅"],
      "愛知県": ["名古屋駅","金山駅","豊橋駅"],
      "三重県": ["津駅","伊勢市駅","鳥羽駅"],
      "滋賀県": ["大津駅","彦根駅"],
      "京都府": ["京都駅","嵯峨嵐山駅","宇治駅"],
      "大阪府": ["大阪駅","天王寺駅","新大阪駅","なんば駅"],
      "兵庫県": ["神戸駅","三ノ宮駅","姫路駅"],
      "奈良県": ["奈良駅","大和西大寺駅"],
      "和歌山県": ["和歌山駅","白浜駅"],
      "鳥取県": ["鳥取駅","米子駅"],
      "島根県": ["松江駅","出雲市駅"],
      "岡山県": ["岡山駅","倉敷駅"],
      "広島県": ["広島駅","宮島口駅","福山駅"],
      "山口県": ["新山口駅","下関駅"],
      "徳島県": ["徳島駅","鳴門駅"],
      "香川県": ["高松駅","琴平駅"],
      "愛媛県": ["松山駅","今治駅","道後温泉駅"],
      "高知県": ["高知駅","中村駅"],
      "福岡県": ["博多駅","小倉駅","天神駅"],
      "佐賀県": ["佐賀駅","唐津駅"],
      "長崎県": ["長崎駅","佐世保駅","ハウステンボス駅"],
      "熊本県": ["熊本駅","阿蘇駅"],
      "大分県": ["大分駅","別府駅","由布院駅"],
      "宮崎県": ["宮崎駅","日南駅"],
      "鹿児島県": ["鹿児島中央駅","指宿駅","霧島神宮駅"],
      "沖縄県": ["那覇空港駅","美栄橋駅","首里駅"]
    };

    function rebuild(pref) {
      const list = MAP[pref] || [];
      subSel.innerHTML = "";
      subSel.appendChild(new Option("———", "")); // プレースホルダ
      list.forEach(s => subSel.appendChild(new Option(s, s)));
      // 県を変えたら値をクリア
      subSel.value = "";
      // 駅がない県（まず無いけど）なら無効化
      subSel.disabled = list.length === 0;
    }

    // 初期化（読み込み時）
    rebuild(prefSel.value);
    // 変更時
    prefSel.addEventListener("change", e => rebuild(e.target.value));
  });
</script>

{% endblock %}
