{% extends "base.html" %}
{% block title %}プラン作成{% endblock %}

<style>
/* 入力欄とプルダウンの高さ・フォントを揃える */
.shop-formset-item {
  margin-bottom: 18px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
}
.shop-formset-row {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 12px !important;
  width: 100%;
}
.shop-formset-item input[type="text"] {
  height: 40px !important;
  font-size: 16px !important;
  box-sizing: border-box !important;
  border-radius: 7px !important;
  border: 1.5px solid #ffb3b3 !important;
  display: block !important;
  background: linear-gradient(90deg, #fffafa 0%, #ffffff 100%) !important;
  color: #a33 !important;
  margin: 0 !important;
  padding: 0 14px !important;
  line-height: 40px !important;
  width: 100%;
}
.shop-formset-item .form-label {
  font-size: 0.95em;
  color: #444;
  margin-bottom: 0;
  white-space: nowrap;
  display: inline-block;
  margin-top: 0;
}
.shop-formset-item select,
.shop-formset-item input[type="number"] {
  height: 40px !important;
  font-size: 16px !important;
  box-sizing: border-box !important;
  border-radius: 7px !important;
  border: 1.5px solid #ffb3b3 !important;
  display: inline-block !important;
  background: linear-gradient(90deg, #ffe5e5 0%, #fff5f5 100%) !important;
  color: #a33 !important;
  margin: 0 !important;
  padding: 0 14px !important;
  line-height: 40px !important;
  width: auto !important;
  min-width: 90px;
}
.shop-formset-item input[type="number"] {
  width: 80px !important;
}
.shop-formset-item .white-min {
  font-size:0.95em;
  color:#fff !important;
  margin-left:2px;
  display: inline-block;
}
</style>
{% block content %}

<div class="plan-form-vertical">
  <h1>Create New Plan</h1>
  <form method="post" class="plan-form-vertical-form login-form-vertical">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {% for f in form %}
      <label class="login-label" style="width: 100%; margin-bottom: 12px;">
        <span style="font-weight:600; margin-bottom: 2px;">{{ f.label }}</span>
        {{ f }}
        {% for e in f.errors %}
          <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
        {% endfor %}
      </label>
    {% endfor %}


    <div style="margin-top: 24px;">
      <h3>Shops Visited (1 to 10 shops)</h3>
      {{ formset.management_form }}
      <div id="shop-formset-list">
        {% for spot_form in formset %}
          <div class="shop-formset-item">
            {{ spot_form.name }}
            <div class="shop-formset-row">
              <span class="form-label">滞在時間</span>
              {{ spot_form.stay_minutes }}
              {% if not forloop.last %}
                <span class="form-label" style="margin:0 0 0 16px;">↕ 移動時間</span>
                <input type="number" name="move_minutes_{{ forloop.counter0 }}" min="0" max="180" step="1" value="0" />
                <span class="white-min">分</span>
              {% endif %}
            </div>
            {% for e in spot_form.name.errors %}
              <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
            {% endfor %}
            {% for e in spot_form.stay_minutes.errors %}
              <div style="color:#c00; font-size:0.9em;">{{ e }}</div>
            {% endfor %}
          </div>
        {% endfor %}
      </div>
      <div style="margin-top:8px; color:#888; font-size:0.95em;">You must enter at least 1 shop (up to 5).</div>
    </div>

  <!-- JS不要: Add/Delete機能なし・5個固定 -->

    <button type="submit">Save</button>
  </form>
  <p style="margin-top:16px;"><a href="/">← Back to Home</a></p>
</div>

{% endblock %}
